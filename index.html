<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
<script>

var config = {
    type: Phaser.AUTO,
    width: 128,
    height: 128,
    pixelArt: true,
    zoom: 4,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);

function preload ()
{
    
    this.load.image('backdrop', 'assets/background/backdrop.png');
    this.load.image('ground', 'assets/background/groundlv1.png');
    this.load.image('table', 'assets/background/table.png');

    this.load.spritesheet('tobylaying', 
        'assets/spritesheets/tobylaying.png',
        { frameWidth: 32, frameHeight: 32 }
    );

    this.load.spritesheet('tobypounce', 
        'assets/spritesheets/tobypounce.png',
        { frameWidth: 32, frameHeight: 32 }
    );
    
    this.load.spritesheet('butterfly', 
        'assets/spritesheets/butterfly.png',
        { frameWidth: 6, frameHeight: 4 }
    );

    var url;
  
    url = 'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexpathfollowerplugin.min.js';
    this.load.plugin('rexpathfollowerplugin', url, true);

}

function create ()
{
    this.add.image(0, 0, 'backdrop').setOrigin(0, 0.75);

    platforms = this.physics.add.staticGroup();

    platforms.create(0, 0, 'ground').setOrigin(0, -8.85).refreshBody();

    platforms.create(65, 92, 'table');

//Creating animations

//Toby laying on the table tail wag animation
    this.anims.create({
        key: 'wag',
        frames: this.anims.generateFrameNumbers('tobylaying', { start: 0, end: 2}),
        frameRate: 1,
        repeat: 1
    });

    this.anims.create({
        key: 'crouch',
        frames: this.anims.generateFrameNumbers('tobypounce', { start: 0, end: 15}),
        frameRate: 3,
        repeat: 0
    });

    this.anims.create({
        key: 'flutter',
        frames: this.anims.generateFrameNumbers('butterfly', { start: 0, end: 4}),
        frameRate: 10,
        repeat: 11
    });

//creating butterfly paths
    var path = this.add.path(120, 20)
            .lineTo(90, 66)
            .ellipseTo(95, 60);

            var gameObject = this.add.sprite(0, 0, "butterfly")
                .play('flutter');
                

            gameObject.pathFollower = this.plugins.get('rexpathfollowerplugin').add(gameObject, {
            path: path,
            t: 0,
            rotateToPath: false
        });

        this.tweens.add({
            targets: gameObject.pathFollower,
            t: 1,
            ease: 'Cubic', // 'Cubic', 'Elastic', 'Bounce', 'Back'
            duration: 6500,
            repeat: 0,
            yoyo: false
        });

//Adding animations
var gameObject = this.add.sprite(64, 58)
    .play('wag')
    .on('animationcomplete', destroyWaggingTobby, this);     //checking whether animation is complete;

    function destroyWaggingTobby() {
        this.add.sprite(64, 58).play('crouch');
        gameObject.destroy();

    }
}

function update ()
{
}
</script>
</body>
</html>